---
title: "Years in office, promotion incentives, and fiscal behavior: Evidence from Chinese mayors"
author: "Siwei Dai"
date: \today
header-includes:
    - \usepackage{xeCJK}
    - \pagenumbering{arabic}
output: 
    pdf_document:
        latex_engine: xelatex
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r env setup, message=FALSE, warning=FALSE}
library(tidyverse)
library(estimatr)
library(modelsummary)
options(modelsummary_format_numeric_latex = "mathmode")
datapath <- './ps_data/FullData.csv'
df <- as_tibble(read.csv(datapath))
biodatapath <- './ps_data/BiographicalData.csv'
biodf <- as_tibble(read.csv(biodatapath))
fiscdatapath <- './ps_data/fiscal.dta'
fiscdf <- haven::read_dta(fiscdatapath)
```

# Data sources, data tidying, and data description
This project investigates 
Cities in China are under dual-leadership. The municipal party secretary and the mayor jointly leads the city. 

## Data Sources
Two datasets are used for analysis. The first dataset is the "Chinese Political Elite Database" (CPED), compiled by Junyan Jiang (accessed at https://www.junyanjiang.com/data.html). This dataset includes the biographical and career information of all mayors and municipal party secretaries from 2000 to 2015, provincial governors  and party secretaries (1995 - 2015).  This dataset is originally constructed for Jiang (2018), a paper that investigates 

Another dataset documents county-level fiscal revenue and expenditure from 1994 to 2007. The dataset is accessed from the replication data of Xu Xu (2021) who purchased and digitized the original "Fiscal Statistics of Cities and Counties" compiled by the Budget Department of the Ministry of Finance of China. The original paper concerns the effect of implementing digital surveillance programs on public security spending.

## Data Tidying
Before running analyses, I tidied and merged the two datasets to produce a leader-year dataset. On the CPED dataset, I first translated and created the key variables needed for analysis; I then converted the CPED dataset to a county-year dataset using the start date and end date of politicians' terms. 

Two problems arise 
As some politicians may only start their position closer to December, they may not have sufficient control over the fiscal expenditure and income that particular year. For politicians who came into office between July to December, I coded the first year of their tenure the next year. In the following sections, there is a figure that shows the distribution of the month in which newly-appointed mayors start their jobs.

On the county-level fiscal data, I dealt with certain coding discrepancies within the original data. In some cases, missing data is coded `NA` and in other cases, it's coded 0. I recoded the missing data points on social expenditure and fiscal revenue to `NA`s.  

Finally, I merged the datasets together, and filter out only the mayors and their terms.

## Data Description
The final dataset includes 1397 mayors and has 11,062 leader-year observations. Each observation documents who the leaders were at a particular city in a given year, how much was the fiscal expenditure and revenue. 

```{r data cleaning}
df_tidy <- df %>% 
    # translate the variables into English
    # exper_num refers to the career stage
    rename('identifier' = 用户编码,
           'name' = 姓名,
           'job' = 标志位,
           'position_ori' = 级别, 
           'exper_num' = 经历序号,
           'start_date' = 起始时间.YYYY.MM.DD.,
           'end_date' = 终止时间..YYYY.MM.DD..,
           'prefectural_code' = 二级关键词编码,
           'provincial_code' = 一级关键词编码,
           'position_code' = 职务一级关键词编码) %>% 
    select(identifier, name, job, position_ori, exper_num, start_date, end_date, 
           prefectural_code, provincial_code, position_code) %>% 
    # impute prefectural code from provincial code 
    # if the prefectural code is missing due to being a provincial leader
    mutate(prefectural_code = ifelse(is.na(prefectural_code), provincial_code, 
                                     prefectural_code)) %>% 
    # recode the position from strings into numeric; larger the number, higher the position
    mutate('position_numeric' = case_when(position_ori == '无级别' ~ 0, 
                                          position_ori == '小于副处' ~ 1,
                                          position_ori == '副处' ~ 2,
                                          position_ori == '正处' ~ 3,
                                          position_ori == '副厅' ~ 4,
                                          position_ori == '正厅' ~ 5,
                                          position_ori == '副部' ~ 6,
                                          position_ori == '正部' ~ 7,
                                          position_ori == '副国' ~ 8,
                                          position_ori == '正国' ~ 9)) %>% 
    # Code the term length
    mutate('term_length' = (as.numeric(as.Date(end_date) - as.Date(start_date)))/365,
    # As discussed above, for those who started their job between July to December,
    # I code the next year as the start year of their term 
           'start_year' = ifelse(as.numeric(format(as.Date(start_date), '%b')) >= 7, 
                                 as.numeric(format(as.Date(start_date), '%Y')) + 1, 
                                 as.numeric(format(as.Date(start_date), '%Y'))),
           'end_year' = as.numeric(format(as.Date(end_date), '%Y'))) %>%
    # Create variables to indicate if the official is a mayor, governor or party secretary 
    mutate(governor = (job == "省长"),
           mayor = (job == "市长"),
           party_secretary = job %in% c("市委书记", "省委书记"),
           leader = governor | mayor | party_secretary) %>% 
    # Create a term identifier
    mutate(term_identifier = row_number()) %>% 
    # Create promotion or demotion
    group_by(name) %>% 
    # rank the experiences in the temporal order
    arrange(exper_num, by_group = TRUE) %>% 
    mutate(dem = (lag(position_numeric) > position_numeric),
           # or being moved to an inconsequential position
           prom = (lead(position_numeric) > position_numeric))

biodf_tidy <- biodf %>% 
    rename('bio_identifier' = X,
           'birth_date' = 出生日期.YYYY.MM.DD.,
           'discipline_date' = '查处.罢黜时间',
           'discipline_cause' = '查处.罢黜原因') %>% 
    select(bio_identifier, birth_date, discipline_date, discipline_cause) %>% 
    mutate('birth_year' = as.numeric(format(as.Date(birth_date), '%Y')),
           'disciplined' = (discipline_cause == '贪污腐败' | discipline_cause == '违纪'),
           'discipline_year' = as.numeric(format(as.Date(discipline_date), '%Y')))

fiscdf_tidy <- fiscdf %>% 
    filter(!is.na(admcode) & admcode %in% unique(df_tidy$prefectural_code)) %>% 
    # Code the income and expenditure observations that are 0 to NA
    mutate(income_ttl = ifelse(income_ttl == 0, NA, income_ttl),
           exp_ttl = ifelse(exp_ttl == 0, NA, exp_ttl),
           exp_shbz = ifelse(exp_shbz == 0, NA, exp_shbz))
```

### Converting the Political Elite datase to a leader-year dataset
```{r county-year conversion}
df_tidy_year <- df_tidy %>% 
    # filter out NAs, otherwise there would be errors in mutating new variables
    filter(!is.na(start_year) & !is.na(end_year) & !is.na(prefectural_code)) %>% 
    mutate('year' = map2(start_year, end_year, `:`)) %>% 
    unnest(cols = c(year)) %>% 
    # filter out the experiences after the fiscal data is available
    filter(year >= 1994) %>% 
    # Create two dummies
    mutate('term_year' = year - start_year + 1,
           'first_year' = ifelse(year == start_year, 1, 0),
           'last_year' = ifelse(year == end_year, 1, 0))
```

### Merge the dataset with spending data and biographical information and filter out mayors only
```{r data merging}
# Merge the three data frames together into one dataset
df_merged <- fiscdf_tidy %>% 
    left_join(df_tidy_year, by = c('admcode' = 'prefectural_code',
                             'year' = 'year')) %>% 
    left_join(biodf_tidy, by = c('identifier' = 'bio_identifier')) %>% 
    # Create the key variables
    mutate('income_log' = log(income_ttl),
           'exp_log' = log(exp_ttl),
           'social_exp_log' = log(exp_shbz),
           'edu_exp_log' = log(exp_jy),
           'age' = year - birth_year,
           'age50' = age >= 50,
           'midterm' = (term_year >= 3),
           'completeterm' = (term_year >= 5)) %>% 
    # filter out the leaders
    filter(leader == 1) %>% 
    arrange(admcode, year)

df_merged_mayor <- df_merged %>% 
    filter(mayor)
```

## Distribution of start and end date
As discussed above in the data tidying section, one concern with merging fiscal data with political cycles is how much influence a politician has over fiscal spending and revenue. If all politicians are appointed to their job in January of each year, we can assume they have substantial control over the fiscal behaviors of that year. Alternatively, if politicians are appointed in December of a particular year, they wouldn't have enough control over policies and fiscal revenue/expenditure. The following figure shows the distribution of the month that mayors start their new jobs.

```{r}
fig_distofstartdate <- df_merged %>% 
    filter(!is.na(format(as.Date(start_date), '%b'))) %>% 
    ggplot(aes(x = format(as.Date(start_date), '%b'))) +
    geom_bar() +
    labs(x = 'Month of term start', 
         y = 'Count',
         title = "Distribution of the month municipal leadership starts")
fig_distofstartdate
# ggsave("./FinalPJ/fig_distofstartdate.png")
```


# Background: Promotion incentives, term length, and age constraint
## Uncertainty in term prospects: distribution of term length for Chinese mayors
There is a formal term limit for Chinese mayors and provincial governors: 5 years. Yet this formal term limit is not strictly enforced. As shown in the following figure, most of Chinese mayors are promoted or transferred to other positions before reaching the 5-year term limit (the red vertical line on the figure marks the fifth year in office). This means that politicians face substantial uncertainty on how long they could stay at a particular position. 

```{r}
fig_tenuretime <- df_merged_mayor %>% 
    group_by(name) %>% 
    ggplot(aes(x = term_length)) +
    geom_histogram(binwidth = 0.5) + 
    coord_cartesian(xlim = c(0, 10)) +
    geom_vline(color = "red", xintercept = 5) +
    # Change x coordinates
    labs(x = "Term length of munipal/provincial leadership",
         y = "Count",
         title = "Histogram of municipal leadership term length",
         caption = "Zoomed in on 10 years")
fig_tenuretime
# ggsave("./FinalPJ/fig_tenuretime.png")
```

## Age constraint in promotions
Chinese politicians also face another constraint in promotions: age. 


```{r}
fig_promotiontime <- df_merged %>% 
    group_by(name) %>% 
    filter(job == "市长") %>% 
    filter(age == min(age)) %>% 
    ggplot(aes(x = age)) +
    geom_histogram(binwidth = 1) +
    geom_vline(color = "red", xintercept = 55) +
    labs(x = "The age when the official gets the first mayor job",
         y = "Count",
         title = "Politician's age when he has the first municipal leadership")
fig_promotiontime
```




# Promotion incentives and Fiscal Behaviors

Given the age constraint on future promotions and substantial uncertainty on how long a politician can serve as a mayor or provincial governor, we would predict that in the starting years of their terms, politicians are incentivised to signal their competence to the upper-level organizational department for promotion. As a politician serves longer on a particular position and her age goes up, promotion incentives may decrease and fiscal necessity pushes the politician back to responsible behavior. 

The time period for the data .

This difference in promotion incentives could be reflected in fiscal behaviors. Building on existing literature, I predict that politicians have two objectives: boost economic performance and maintain social stability (or prevent collective action). To boost economic performance, politicians may create tax exemptions or sell the state-owned land cheaply to developers for development; this would result in lower fiscal revenue. On the social stability side, politicians may opt to increase social expenditure to reduce social grievances and prevent collective actions. 

Hypothesis 1: social spending is positively correlated with 

Hypothesis 2: 

### Dependent variables
The key dependent variables are city-level `social expenditure` and `fiscal revenue`. The dependent variables are logged in the regression models.

### Independent variables
The key independent variables are `years in office` and `age`. 

In the models, I control for year fixed
I also control for year fixed effects in the models to capture for the macro



To account for the effect of age on promotion incentives, I have also 

## Do Chinese mayors change fiscal behaviors over different years in an office?

The following figure shows how 

I used `pivot_longer` to restructure

```{r graph, warning=FALSE}
# filter out who the mayors/leaders are
fig_fisc <- df_merged_mayor %>% 
    pivot_longer(cols = c(social_exp_log, income_log),
                 names_to = "fiscal_type",
                 values_to = "values") %>% 
    ggplot(aes(x = term_year, y = values, color = fiscal_type)) +
    geom_point() +
    geom_smooth(method = 'lm', formula = y ~ poly(x, 2)) +
    labs(x = "Years in current office",
         y = "Fiscal performance (logged)",
         title = "Fiscal performance over years in current office") +
    scale_color_discrete(name = "Fiscal data (logged)",
                         labels = c("Fiscal revenue", "Social spending"))
fig_fisc
# ggsave("./FinalPJ/fig_fisc.png")
```


## Regression analysis
In the following analysis sections,
The data used in the regressions

```{r mayor's social expenditure, warning=FALSE}
# This set of regressions use social expenditure (logged) as DV
model_socexp <- lm(social_exp_log ~ term_year  + factor(year) + factor(name), 
                   data = df_merged_mayor)
# Produce robust standard errors
modelr_socexp <- lm_robust(social_exp_log ~ term_year, 
                           fixed_effects = ~ year + identifier, 
                           data = df_merged_mayor) 
# Add a non-linear term
modelr_socexp2 <- lm_robust(social_exp_log ~ poly(term_year, 2), 
                            fixed_effects = ~ year + identifier,  
                            data = df_merged_mayor) 
# add an interaction with age
modelr_socexp_interage <- lm_robust(social_exp_log ~ age50*term_year, 
                                    fixed_effects = ~ year + name, 
                                    data = df_merged_mayor)
mdlist_socexp <- list(model_socexp, modelr_socexp, modelr_socexp2, modelr_socexp_interage)
# Create a tibble to be added into the regression table, 
# reflecting if fixed effects have been added into the model
tbl_fe <- tibble("variable" = c("Leader fixed effects", "Year fixed effects"),
                 "values" = "Y") %>% 
    cbind(replicate(.$values, n = length(mdlist_socexp) - 1))
# Produce the regression table
tbl_socexp <- modelsummary(mdlist_socexp, 
             stars = TRUE,
             # output = "./FinalPJ/tbl_socexp.jpg",
             coef_map = c("term_year" = "Years in office",
                          "poly(term_year, 2)1" = "Years in office", 
                          "poly(term_year, 2)2" = "Years in office (squared)",
                          "age50TRUE" = "Age",
                          "age50TRUE:term_year" = "Age X Years in office"),
             add_rows = tbl_fe)
tbl_socexp
```




## Interpretation part: coef, standard errors, p-values
Model 1 is a linear model of regressing social expenditure on years in current office, while controlling for learder and year fixed effects. The coefficient on the `Years in office` variable is - 0.117, which means for every 1 year increase in `Years in office` is associated with a 0.117 decrease in logged social expenditure. The standard error on `Years in office` is 0.012

Model 2 uses the same specification as model 1, but it is estimated with robust standard errors. The robust standard error on `Years in office` is 0.018, different from the standard error produced in model 1. 

Talk about the relative changes

Model 3 changes the specification and uses a second-degree polynomial of `Years in office`. It is also estimated with robust standard errors. Compared to model 2, the coefficient on `Years in office` becomes 

Model 4 adds an interaction term of years in office and age, and is estimated with robust standard errors. Since `age` is perfectly collinear with The coefficient on the `Years in office` variable

## Income trends
```{r income, warning=FALSE}
# This regression is for mayors
model_inc <- lm(income_log ~ term_year + factor(year) + factor(name), 
                data = df_merged_mayor) 
# Estimate with robust standard errors
model_inc2 <- lm_robust(income_log ~ term_year, fixed_effects = ~ year + name, 
                 data = df_merged_mayor) 
# Add a non-linear term into the sp
modelr_inc2 <- lm_robust(income_log ~ poly(term_year, 2), fixed_effects = ~ year + name, 
                         data = df_merged_mayor)
# add an interaction with age
model_inc_interage <- lm_robust(income_log ~ age50*term_year,
                                fixed_effects = ~ year + name,
                                data = df_merged_mayor)
mdlist_inc <- list(model_inc, "Robust standard errors" = model_inc2, "2nd-degree polynomial" = modelr_inc2, model_inc_interage)
# Producing the regression tables
modelsummary(mdlist_inc,
             stars = TRUE,
             coef_map = c("term_year" = "Years in office",
                          "poly(term_year, 2)1" = "Years in office", 
                          "poly(term_year, 2)2" = "Years in office (squared)",
                          "age50TRUE" = "Age",
                          "age50TRUE:term_year" = "Age X Years in office"),
             add_rows = tbl_fe)
```

## Interpretations
Table 2 shows that the regression results when using city-level fiscal revenue (logged) as the dependent variable. In all the models, leader fixed effects and year fixed effects are controlled.  
Model 1 


The results within the 


## Alternative specifications
In the following regressions, I used 
### Using indicator variables
```{r}
# Using indicator variables
model_fac_socexp <- lm_robust(social_exp_log ~ completeterm, 
                              fixed_effects = ~ year + name, 
                              data = df_merged %>% filter(mayor))
model_fac_income <- lm_robust(income_log ~ completeterm, 
                              fixed_effects = ~ year + name, 
                              data = df_merged %>% filter(mayor)) 
mdlist_fac <- list(model_fac_socexp, model_fac_income)
modelplot(mdlist_fac) +
    geom_vline(xintercept = 0)
```


## Bootstrap the standard errors
In this section, 
```{r}

```

